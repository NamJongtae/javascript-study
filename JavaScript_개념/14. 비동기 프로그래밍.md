# 14. ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°

## 1. ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë¹„ë™ê¸° **_asynchronous_**

### **ë¹„ë™ê¸°Â *asynchronous*Â ì½”ë“œ**

**ë™ê¸°**Â *synchronous*Â ì½”ë“œì™€ ë‹¬ë¦¬,Â **ì½”ë“œê°€ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ**

- ì¼ë°˜ì ìœ¼ë¡œ íƒ€ì„ì•„ì›ƒ, ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ë“±Â **ì‹œê°„ì´ ê±¸ë¦¬ëŠ”**Â ì‘ì—…ì— ì‚¬ìš©
- ë‹¹ì¥ í•  ìˆ˜ ìˆëŠ” ê²ƒë“¤ì„ ë¨¼ì € ë‹¤ í•˜ê³ , ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì‘ì—…ì€ ë’¤ë¡œ ë„˜ê¸°ê¸°
- ğŸ’¡ ë§Œì•½ ë¹„ë™ê¸° ë°©ì‹ì´ ì—†ë‹¤ë©´ - ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ë™ì•ˆ í™”ë©´ì´ ì–´ëŠ” ë“± ë¶ˆí¸í•¨

**ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë¹„ë™ê¸°ì˜ ë™ì‘ì›ë¦¬**

- ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œë¡œ ë¹„ë™ê¸° ì‘ì—…ì€ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŒ
- ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆëŠ” ì´ìœ 
  - ì´ë²¤íŠ¸ ë£¨í”„ì™€ íƒœìŠ¤í¬í
  - Web API

**ì´ë²¤íŠ¸ ë£¨í”„ì™€ íƒœìŠ¤í¬í**

![image](https://github.com/NamJongtae/javascript-study/assets/113427991/cb7799c4-3694-403c-b6e6-57f920d93e1b)

- ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì€Â **ì½œ ìŠ¤íƒ (Call Stack)** ê³¼Â **ë©”ëª¨ë¦¬ í™ (Memory Heap)** ìœ¼ë¡œ êµ¬ì„±
  - ì½œ ìŠ¤í… : í•¨ìˆ˜ í˜¸ì¶œ ë° ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ê´€ë¦¬ë˜ëŠ” ë©”ëª¨ë¦¬ ì˜ì—­ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ í•¨ìˆ˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ìˆœì°¨ì ìœ¼ë¡œ ìŒ“íˆê³  í•¨ìˆ˜ê°€ ì‹¤í–‰
  - ë©”ëª¨ë¦¬ í™ :Â **ì°¸ì¡°í˜• ë°ì´í„°**ê°€ ì €ì¥ë˜ëŠ” ë©”ëª¨ë¦¬ ê³µê°„ ì…ë‹ˆë‹¤. ì½œ ìŠ¤íƒì˜ ìš”ì†Œì¸ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ëŠ” í™ì— ì €ì¥ëœ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ê²Œ ë©ë‹ˆë‹¤.
- ì´ë²¤íŠ¸ ë£¨í”„ : **ë¸Œë¼ìš°ì €ì˜ ë‚´ì¥ ê¸°ëŠ¥** ì¤‘ í•˜ë‚˜ë¡œ **ì‹¤í–‰ í•  í•¨ìˆ˜ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í• ë¡œ ì½œ ìŠ¤íƒê³¼ í (Queue)ì˜ í•¨ìˆ˜ë¥¼ ê³„ì† í™•ì¸**í•˜ë©°, **ì½œ ìŠ¤íƒì´ ë¹„ì–´ ìˆê³  íì— ëŒ€ê¸° ì¤‘ì¸ í•¨ìˆ˜ê°€ ìˆë‹¤ë©´, ìˆœì°¨ì ìœ¼ë¡œ íì— ëŒ€ê¸°ì¤‘ì¸ í•¨ìˆ˜ë¥¼ ì½œ ìŠ¤íƒìœ¼ë¡œ ì´ë™ì‹œí‚´**
- íƒœìŠ¤í¬ í : íƒœìŠ¤í¬ íëŠ” ë¹„ë™ê¸° ì‘ì—…ì˜ ì™„ë£Œëœ ê²°ê³¼ë‚˜ ì²˜ë¦¬í•  ì½œë°± í•¨ìˆ˜ë“¤ì´ ëŒ€ê¸°í•˜ëŠ” ê³µê°„ìœ¼ë¡œ **ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ í (Micro Task Queue, ì¼ë°˜ íƒœìŠ¤í¬ íì™€ ë™ì¼)**Â **ë§¤í¬ë¡œ íƒœìŠ¤í¬ í (Macro Task Queue)** **rAF í (Request Animation Frame Queue)** ë¡œ ë‚˜ë‰¨
  - íëŠ” ë¨¼ì € ë“¤ì–´ê°„ ë°ì´í„°ê°€ ë¨¼ì € ë‚˜ì˜¤ëŠ” íŠ¹ì§• **(FIFO, First In First Out)** ì„ ê°€ì§
  - **ë§¤í¬ë¡œ íƒœìŠ¤í¬ í (Macro Task Queue)** : DOM ì´ë²¤íŠ¸ ì½œë°±, íƒ€ì´ë¨¸(setTimeout, setInterval), ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ë“±ì„ ì²˜ë¦¬
  - **ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ í (Micro Task Queue)** ëŠ” í”„ë¡œë¯¸ìŠ¤ í•¸ë“¤ëŸ¬ awit, MutationObserver, process ë“±ì„ ì²˜ë¦¬
  - **rAF í (Request Animation Frame Queue)** : `requestAnimationFrame()` ì²˜ëŸ¼ ì• ë‹ˆë©”ì´ì…˜ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ì½œë°± í•¨ìˆ˜ê°€ ëŒ€ê¸°í•˜ëŠ” ê³³ì´ë‹¤.
  - ì‹¤í–‰ ìš°ì„  ìˆœìœ„ëŠ”Â **ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ í > rAF í > íƒœìŠ¤íŠ¸ í**Â ìˆœì„œ
- ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” í•˜ë‚˜ì˜ ì½œ ìŠ¤íƒì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ì¢…ë£Œë˜ì–´Â **ì½œ ìŠ¤íƒì—ì„œ ëª¨ë‘ ì œê±° ë˜ê¸° ì „**ê¹Œì§€ëŠ” ë‹¤ë¥¸ íƒœìŠ¤í¬ ì‹¤í–‰ì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤. ì¦‰, **ë™ê¸°ì  ì‘ì—…ì´ ëª¨ë‘ ëë‚  ë•Œê¹Œì§€ëŠ” ë¹„ë™ê¸° ì‘ì—…ë„ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.**

**ë¹„ë™ê¸° ì˜ˆì‹œ ì½”ë“œ**

```javascript
// 1ì´ˆ ~ 1.5ì´ˆ ì‚¬ì´ ë¬´ì‘ìœ„ ì‹œê°„ ì•ˆì— ë„ì°©
function doRace(num, name) {
  console.log(`ğŸ‘Ÿ ${num}ë²ˆ ${name} ì¶œë°œ`);

  setTimeout(() => {
    console.log(`ğŸš© ${num}ë²ˆ ${name} ë„ì°©`);
  }, 1000 + Math.random() * 500);
}
```

```javascript
doRace(1, "Jon");
```

```javascript
"ì² ìˆ˜,ì˜í¬,ëŒì¤€,ì •ì•„,ê¸¸ëˆ".split(",").forEach((itm, idx) => doRace(++idx, itm));
```

- ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œë¡œ ì‹¤í–‰

![async1](https://github.com/NamJongtae/javascript-study/assets/113427991/e8f72bcc-5f96-49bf-b359-a3957f581609)

- ì‹¤í–‰ ì‹œì ì— ë„ì°©í•˜ë©´ ë™ê¸° ì½”ë“œëŠ” ì‹¤í–‰
- ë¹„ë™ê¸° ì½œë°± ì½”ë“œëŠ” ì™¸ë¶€ í™˜ê²½(Web API ë“±)ìœ¼ë¡œ ë„˜ê²¨ì¤Œ


![async2](https://github.com/NamJongtae/javascript-study/assets/113427991/bf03a078-5036-48ab-8a45-3ea756388cc7)

- ì´ë²¤íŠ¸ ë£¨í”„ì™€ íƒœìŠ¤í¬ íë¥¼ í†µí•´ ë¹„ë™ê¸° ì‘ì—…ë“¤ì„ ì²˜ë¦¬

![async3](https://github.com/NamJongtae/javascript-study/assets/113427991/acd3e1eb-5f8c-40da-8248-b6e46886a2da)

- íƒœìŠ¤í¬ íì— í•˜ë‚˜ì”© ë¹„ë™ê¸° ì½œë°±ë“¤ì´ ìŒ“ì„
- ì´ë²¤íŠ¸ ë£¨í”„ëŠ” íƒœìŠ¤í¬ íì˜ ì‘ì—…ì´ ë„ì°©í•˜ëŠ”ëŒ€ë¡œ ì½œ ìŠ¤í…ìœ¼ë¡œ ì´ë™ë˜ì–´ ì‹¤í–‰

![async5](https://github.com/NamJongtae/javascript-study/assets/113427991/9c49d1f0-1626-4d04-9343-860adf9d5560)

## 2. ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°

### ì½œë°± í•¨ìˆ˜ callback function

- ì½œë°± í•¨ìˆ˜ëŠ” ë‹¤ë¥¸ í•¨ìˆ˜ì˜ ì¸ìë¡œ í•¨ìˆ˜ë¥¼ ë„˜ê¸°ëŠ” ê²ƒì„ ì˜ë¯¸
- ì¦‰, í•¨ìˆ˜ì˜ ì œì–´ê¶Œì„ ë‹¤ë¥¸ í•¨ìˆ˜ì— ë„˜ê¸°ëŠ”ê²ƒì„ ì˜ë¯¸
- ì½œë°± í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë° êµ¬í˜„ ê°€ëŠ¥
- í•˜ì§€ë§Œ ì½œë°± í•¨ìˆ˜ë¥¼ ì—°ì†ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤ë©´ ì½œë°± ì§€ì˜¥ Callback hell ë°œìƒ
  - ì½œë°± ì§€ì˜¥ : ì½œë°±í•¨ìˆ˜ ì•ˆì— ë˜ ë‹¤ë¥¸ ì½œë°±í•¨ìˆ˜ë¥¼ ë„£ì–´ ê³„ì† ë“¤ì—¬ì“°ê¸°ê°€ ëŠ˜ì–´ë‚˜ **ê°€ë…ì„±ê³¼ ì§ê´€ì„±ì´ ë‚®ì•„ì§€ëŠ” í˜„ìƒ**

```javascript
setTimeout(() => {
  console.log(1);
  setTimeout(() => {
    console.log(2);
    setTimeout(() => {
      console.log(3);
      setTimeout(() => {
        console.log(4);
        setTimeout(() => {
          console.log(5);
        }, 500);
      }, 500);
    }, 500);
  }, 500);
}, 500);
```

**ğŸƒ ë¦´ë ˆì´ ì˜ˆì œ**

- **ê° ê³¨ì¸ì‹œê°„ ê¸°ë¡**Â - ì´ì „ ì½œë°±í•¨ìˆ˜ì˜ ê²°ê³¼ê°€ ë‹¤ìŒ ì½œë°±í•¨ìˆ˜ë¡œ ë„˜ê²¨ì ¸ ì¶•ì ë¨
- í•œ ì£¼ìë¼ë„ ë°ë“œë¼ì¸(ë°€ë¦¬ì´ˆ)ì„ ë„˜ê¸°ë©´ ì‹¤íŒ¨ - ì£¼ìë§ˆë‹¤ ë‹¤ë¥¸ ì‹¤íŒ¨ ë©”ì‹œì§€ ì¶œë ¥
- ì™„ì£¼ ì‹¤íŒ¨ì‹œÂ `ğŸ˜¢ ì™„ì£¼ ì‹¤íŒ¨ - ${ì „ì²´ ì†Œìš”ì‹œê°„}`Â ì¶œë ¥
- ì‹¤íŒ¨ë“  ì„±ê³µì´ë“  ë§ˆì§€ë§‰ì—Â `- ê²½ê¸° ì¢…ë£Œ - -`Â ì¶œë ¥

```javascript
const DEADLINE = 1400;

function relayRun(name, start, nextFunc, failMsg) {
  console.log(`ğŸ‘Ÿ ${name} ì¶œë°œ`);
  const time = 1000 + Math.random() * 500;

  setTimeout(() => {
    if (time < DEADLINE) {
      console.log(`ğŸš© ${name} ë„ì°© - ${(start + time) / 1000}ì´ˆ`);
      nextFunc?.(start + time);
    } else {
      console.log(failMsg);
      console.log(`ğŸ˜¢ ì™„ì£¼ ì‹¤íŒ¨ - ${(start + time) / 1000}ì´ˆ`);
    }

    if (time >= DEADLINE || !nextFunc) {
      console.log("- - ê²½ê¸° ì¢…ë£Œ - -");
    }
  }, time);
}
```

```javascript
relayRun(
  "ì² ìˆ˜",
  0,
  (start1) => {
    relayRun(
      "ì˜í¬",
      start1,
      (start2) => {
        relayRun(
          "ëŒì¤€",
          start2,
          (start3) => {
            relayRun(
              "ì •ì•„",
              start3,
              (start4) => {
                relayRun("ê¸¸ëˆ", start4, null, "ì•„ì•„, ì•„ê¹ìŠµë‹ˆë‹¤...");
              },
              "ì •ì•„ì—ê²Œ ë¬´ë¦¬ì˜€ë‚˜ë³´ë„¤ìš”."
            );
          },
          "ëŒì¤€ì´ ë¶„ë°œí•´ë¼."
        );
      },
      "ì˜í¬ê°€ ì™„ì£¼í•˜ì§€ ëª»í–ˆë„¤ìš”."
    );
  },
  "ì² ìˆ˜ë¶€í„° ê´‘íƒˆì…ë‹ˆë‹¤. ã… ã… "
);
```

### í”„ë¡œë¯¸ìŠ¤ promise

- **ì½œë°± ì§€ì˜¥ callbakc hell** ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ê°œë°œ
- *(ë³´í†µ ì‹œê°„ì´ ê±¸ë¦¬ëŠ”)*Â ì–´ë–¤ ê³¼ì • ì´í›„Â **ì£¼ì–´ì§„ ë™ì‘ì„ ì‹¤í–‰í•  ê²ƒì´ë€ ì•½ì†**
- ì¤‘ì²©ëœ ë¹„ë™ê¸° ì½”ë“œë¥¼ ì§ê´€ì ì´ê³  ì—°ì†ì ì¸ ì½”ë“œë¡œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í•¨
- [ğŸ‘‰ MDN ë¬¸ì„œ ë³´ê¸°](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise)

```javascript
const borrow = 20;

// ë¹Œë¦° ëˆì˜ 10%ë¥¼ ë”í•´ ê°’ê² ë‹¤ëŠ” ì•½ì†
// rejectëŠ” ì§€ê¸ˆ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
const payWith10perc = new Promise((resolve, reject) => {
  resolve(borrow * 1.1);
});

payWith10perc.then((result) => {
  console.log(result + "ë§Œì›");
});
```

**ìƒì„±ìÂ `Promise`Â -Â [ğŸ‘‰ MDN ë¬¸ì„œ ë³´ê¸°](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise/Promise)**

- *ìƒˆë¡œìš´ ì•½ì†ì„ í•˜ëŠ”*Â ì½”ë“œ
- ì¸ìë¡œ ë°›ëŠ” ì½œë°±í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ ì¸ìÂ `resolve`Â *( ì´ë¦„ì€ ê´€ë¡€ )*Â - ì•½ì† ì´í–‰ ì„±ê³µì‹œ, ë°˜í™˜í•  ê°’ ë„£ì–´ ì‹¤í–‰

**í”„ë¡œë¯¸ìŠ¤ ì¸ìŠ¤í„´ìŠ¤Â *( ë§Œë“¤ì–´ì§„ ì•½ì† )***

- `resolve`ë¥¼ í†µí•´Â *( ì•½ì†ëŒ€ë¡œ )*Â ë°˜í™˜ëœ ê²°ê³¼ë¥¼ ì¸ìë¡œ í•˜ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ë„£ìŒ
- ì¸ìë¡œ ë°›ëŠ” ì½œë°±í•¨ìˆ˜ì˜ ë‘ ë²ˆì§¸ ì¸ìÂ `reject`Â *( ì´ë¦„ì€ ê´€ë¡€ )*Â - ì•½ì† ì´í–‰ ì‹¤íŒ¨ì‹œ, ë°˜í™˜í•  ê°’ ë„£ì–´ ì‹¤í–‰
- `reject`ê°€ ì‹¤í–‰ë˜ë©´Â `resolve`ëŠ” ë¬´ì‹œë¨
- â­ ë˜ ë‹¤ë¥¸Â **í”„ë¡œë¯¸ìŠ¤**ë¥¼ ë°˜í™˜ -Â *ì²´ì´ë‹ ê°€ëŠ¥*
- [ğŸ‘‰ MDN ë¬¸ì„œ ë³´ê¸°](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise/then)Â *( ì¶”ê°€ ì¸ì )*
- ì¼ë°˜ì ìœ¼ë¡œ ë‚´ë¶€ì— ë¹„ë™ê¸° ì½”ë“œë¥¼ ì‚¬ìš©
- ì‹œê°„ì´ ì†Œëª¨ë˜ëŠ” ë¹„ë™ê¸° ê³¼ì • í›„ ~ë¥¼ ë°˜í™˜í•˜ê² ë‹¤ëŠ”Â **ì•½ì†**
- `catch`Â ë©”ì„œë“œ :Â `reject`ë¥¼ í†µí•´Â *( ì‹¤íŒ¨ë¡œ ì¸í•´ )*Â ë°˜í™˜ëœ ê²°ê³¼ë¥¼ ì¸ìë¡œ í•˜ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ë„£ìŒ
- `finally`Â ë©”ì„œë“œ : ì„±ê³µí•˜ë“  ì‹¤íŒ¨í•˜ë“  ì‹¤í–‰í•  ì½œë°± í•¨ìˆ˜ -Â *í•„ìš”í•  ë•Œë§Œ ì‚¬ìš©*
- `then`ê³¼ ë”ë¶ˆì–´ ë©”ì„œë“œ ì²´ì´ë‹ìœ¼ë¡œ ì‚¬ìš©

**ğŸƒ ë¦´ë ˆì´ ì˜ˆì œ í”„ë¡œë¯¸ìŠ¤ë¡œ êµ¬í˜„**

```javascript
const DEADLINE = 1400;

function getRelayPromise(name, start, failMsg) {
  console.log(`ğŸ‘Ÿ ${name} ì¶œë°œ`);

  // ğŸ’¡ ëœë¤ ì‹œê°„ë§Œí¼ ë‹¬ë¦¬ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ê² ë‹¤ëŠ” ì•½ì†ì„ ë§Œë“¤ì–´ ë°˜í™˜
  return new Promise((resolve, reject) => {
    const time = 1000 + Math.random() * 500;

    setTimeout(() => {
      if (time < DEADLINE) {
        console.log(`ğŸš© ${name} ë„ì°© - ${(start + time) / 1000}ì´ˆ`);
        resolve(start + time);
      } else {
        console.log(failMsg);
        reject((start + time) / 1000);
      }
    }, time);
  });
}
```

```javascript
getRelayPromise("ì² ìˆ˜", 0, "ì² ìˆ˜ë¶€í„° ê´‘íƒˆì…ë‹ˆë‹¤. ã… ã… ")
  .then((result) => {
    return getRelayPromise("ì˜í¬", result, "ì˜í¬ê°€ ì™„ì£¼í•˜ì§€ ëª»í–ˆë„¤ìš”.");
  })
  .then((result) => {
    return getRelayPromise("ëŒì¤€", result, "ëŒì¤€ì´ ë¶„ë°œí•´ë¼.");
  })
  .then((result) => {
    return getRelayPromise("ì •ì•„", result, "ì •ì•„ì—ê²Œ ë¬´ë¦¬ì˜€ë‚˜ë³´ë„¤ìš”.");
  })
  .then((result) => {
    return getRelayPromise("ê¸¸ëˆ", result, "ì•„ì•„, ì•„ê¹ìŠµë‹ˆë‹¤...");
  })
  .catch((msg) => {
    console.log(`ğŸ˜¢ ì™„ì£¼ ì‹¤íŒ¨ - ${msg}ì´ˆ`);
  })
  .finally(() => {
    console.log("- - ê²½ê¸° ì¢…ë£Œ - -");
  });
```

### í”„ë¡œë¯¸ìŠ¤ì˜ ë³‘ë ¬ ì²˜ë¦¬

**í”„ë¡œë¯¸ìŠ¤ë¥¼ ë³‘ë ¬ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ Promiseì˜ ì •ì  ë©”ì„œë“œ ì¡´ì¬**

**â‘ ** **`all`Â -Â [ğŸ‘‰ MDN ë¬¸ì„œ ë³´ê¸°](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise/all)**

- í”„ë¡œë¯¸ìŠ¤ì˜ ë°°ì—´ì„ ë°›ì•„ ë™ì‹œì— ì§„í–‰
- ëª¨ë‘ ì„±ê³µí•˜ë©´Â `resolve`ëœ ê°’ë“¤ì„ ë°°ì—´ë¡œ ë°˜í™˜ -Â *`then`ìœ¼ë¡œ ë°›ìŒ*
- í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´Â `catch`Â ì‹¤í–‰

```javascript
// í•œ ëª…ì´ë¼ë„ íƒˆë½í•˜ë©´ ì „ì²´ íƒˆë½
Promise.all("ì² ìˆ˜,ì˜í¬,ëŒì¤€,ì •ì•„,ê¸¸ëˆ".split(",").map(getRunPromise))
  .then(console.log)
  .catch(console.error)
  .finally(() => {
    console.log("- - ê²½ê¸° ì¢…ë£Œ - -");
  });
```

```javascript
// ì„±ê³µì‹œ íƒ‘3 í‘œì‹œ
Promise.all("ì² ìˆ˜,ì˜í¬,ëŒì¤€,ì •ì•„,ê¸¸ëˆ".split(",").map(getRunPromise))
  .then((arr) => {
    return arr
      .sort((a, b) => {
        return a.time - b.time;
      })
      .map(({ name }) => name)
      .splice(0, 3)
      .join(", ");
  })
  .then((top3) => {
    console.log(`íƒ‘3: ${top3}`);
  })
  .catch(console.error)
  .finally(() => {
    console.log("- - ê²½ê¸° ì¢…ë£Œ - -");
  });
```

**â‘¡** **`allSettled`Â -Â [ğŸ‘‰ MDN ë¬¸ì„œ ë³´ê¸°](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled)**

- ì£¼ì–´ì§„ í”„ë¡œë¯¸ìŠ¤ë“¤ì˜ ê²°ê³¼ë¥¼ ë°°ì—´ë¡œ ì¶œë ¥
- ì‹¤íŒ¨ ìœ ë¬´ ê´€ê³„ì—†ì´Â `then`ìœ¼ë¡œ ë°°ì—´ ë°˜í™˜

```javascript
Promise.allSettled("ì² ìˆ˜,ì˜í¬,ëŒì¤€,ì •ì•„,ê¸¸ëˆ".split(",").map(getRunPromise))
  .then(console.log)
  // âš ï¸ catchëŠ” ë™ì‘í•˜ì§€ ì•ŠìŒ
  .finally(() => {
    console.log("- - ê²½ê¸° ì¢…ë£Œ - -");
  });
```

```javascript
Promise.allSettled("ì² ìˆ˜,ì˜í¬,ëŒì¤€,ì •ì•„,ê¸¸ëˆ".split(",").map(getRunPromise))
  .then((arr) => {
    return {
      succ: arr.filter((result) => {
        return result.status === "fulfilled";
      }),
      fail: arr.filter((result) => {
        return result.status === "rejected";
      }),
    };
  })
  .then((res) => {
    res.succ.sort((a, b) => {
      return a.value.time - b.value.time;
    });
    console.log(`ì™„ì£¼: ${res.succ.length}ëª… (1ë“±: ${res.succ[0].value.name})`);
    console.log(`íƒˆë½: ${res.fail.length}ëª…`);
  })

  .finally(() => {
    console.log("- - ê²½ê¸° ì¢…ë£Œ - -");
  });
```

**â‘¢ `any`Â -Â [ğŸ‘‰ MDN ë¬¸ì„œ ë³´ê¸°](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/any)**

- ê°€ì¥ ë¨¼ì € ì„±ê³µí•œ í”„ë¡œë¯¸ìŠ¤ì˜ ê²°ê³¼ë¥¼Â `then`ìœ¼ë¡œ ë°˜í™˜
- ëª¨ë‘ ì‹¤íŒ¨ì‹œ ì˜¤ë¥˜ ë°œìƒ

```javascript
DEADLINE = 1050;

Promise.any("ì² ìˆ˜,ì˜í¬,ëŒì¤€,ì •ì•„,ê¸¸ëˆ".split(",").map(getRunPromise))
  .then(console.log)
  // âš ï¸ ëª¨ë‘ ì‹¤íŒ¨í•´ë„ catchëŠ” ë™ì‘í•˜ì§€ ì•ŠìŒ
  .finally(() => {
    console.log("- - ê²½ê¸° ì¢…ë£Œ - -");
  });
```

**â‘£** **`race`Â -Â [ğŸ‘‰ MDN ë¬¸ì„œ ë³´ê¸°](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise/race)**

- â­Â **ì„±ê³µì´ë“  ì‹¤íŒ¨ë“ **Â ì²« ê²°ê³¼ë¬¼Â `then`Â ë˜ëŠ”Â `catch`ë¡œ ë°˜í™˜

```javascript
// ë‹¤ì„¯ ì£¼ìë“¤ì´ ì„ íƒí•œ ë„ì°©ì§€ë¡œ ì§ˆì£¼
// ë„ì°©ì§€ì— 'ê½'ì´ ìˆìœ¼ë©´(50% í™•ë¥ ) ì‹¤íŒ¨
function getBombRunPromise(name) {
  return new Promise((resolve, reject) => {
    const time = 1000 + Math.random() * 500;

    setTimeout(() => {
      console.log(`ğŸš© ${name} ë„ì°© - ${time / 1000}ì´ˆ`);
      if (Math.random() < 0.5) {
        resolve(`ğŸ™Œ ${name} ìŠ¹ë¦¬!`);
      } else {
        reject(`ğŸ’£ ${name} ê½!`);
      }
    }, time);
  });
}
```

```javascript
Promise.race("ì² ìˆ˜,ì˜í¬,ëŒì¤€,ì •ì•„,ê¸¸ëˆ".split(",").map(getBombRunPromise))
  .then(console.log)
  .catch(console.error)
  .finally(() => {
    console.log("- - ê²½ê¸° ì¢…ë£Œ - -");
  });
```

### async & await

- **Promise** ê¸°ë°˜ìœ¼ë¡œ ì œì‘ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ì¢€ ë” ì‰½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” Syntax sugar
- ë§ˆì¹˜ ë™ê¸° ì½”ë“œì²˜ëŸ¼ ì§ê´€ì ìœ¼ë¡œ ì½”ë”©ì„ í•  ìˆ˜ ìˆìŒ
- [ğŸ‘‰ MDN ë¬¸ì„œ ë³´ê¸°](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/async_function)
- â­Â `await`Â -Â **ì½”ë“œì˜ ì§„í–‰ì„ ë©ˆì¶”ê³ **Â í”„ë¡œë¯¸ìŠ¤ë¡œë¶€í„° ë‹µì„ ë°›ì•„ëƒ„
- ğŸ’¡Â `await`ì€Â `async`Â í•¨ìˆ˜ ë˜ëŠ” ëª¨ë“ˆ ë‚´ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥
- [ğŸ‘‰ MDN ë¬¸ì„œ ë³´ê¸°](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Operators/await)

**ğŸƒ ë¦´ë ˆì´ ì˜ˆì œ async & await êµ¬í˜„**

```javascript
const DEADLINE = 1400;

function getRelayPromise(name, start, failMsg) {
  console.log(`ğŸ‘Ÿ ${name} ì¶œë°œ`);

  // ğŸ’¡ ëœë¤ ì‹œê°„ë§Œí¼ ë‹¬ë¦¬ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ê² ë‹¤ëŠ” ì•½ì†ì„ ë§Œë“¤ì–´ ë°˜í™˜
  return new Promise((resolve, reject) => {
    const time = 1000 + Math.random() * 500;

    setTimeout(() => {
      if (time < DEADLINE) {
        console.log(`ğŸš© ${name} ë„ì°© - ${(start + time) / 1000}ì´ˆ`);
        resolve(start + time);
      } else {
        console.log(failMsg);
        reject((start + time) / 1000);
      }
    }, time);
  });
}
```

```javascript
async function startRelay() {
  try {
    const time1 = await getRelayPromise("ì² ìˆ˜", 0, "ì² ìˆ˜ë¶€í„° ê´‘íƒˆì…ë‹ˆë‹¤. ã… ã… ");

    const time2 = await getRelayPromise(
      "ì˜í¬",
      time1,
      "ì˜í¬ê°€ ì™„ì£¼í•˜ì§€ ëª»í–ˆë„¤ìš”."
    );

    const time3 = await getRelayPromise("ëŒì¤€", time2, "ëŒì¤€ì´ ë¶„ë°œí•´ë¼.");

    const time4 = await getRelayPromise(
      "ì •ì•„",
      time3,
      "ì •ì•„ì—ê²Œ ë¬´ë¦¬ì˜€ë‚˜ë³´ë„¤ìš”."
    );

    const time5 = await getRelayPromise("ê¸¸ëˆ", time4, "ì•„ì•„, ì•„ê¹ìŠµë‹ˆë‹¤...");
  } catch (msg) {
    console.log(`ğŸ˜¢ ì™„ì£¼ ì‹¤íŒ¨ - ${msg}ì´ˆ`);
  } finally {
    console.log("- - ê²½ê¸° ì¢…ë£Œ - -");
  }
}
```

```javascript
startRelay();
```
